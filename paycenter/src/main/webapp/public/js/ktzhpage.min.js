function prepare(e,n,a){function t(e){return layer.msg(e,{icon:16,shade:.3})}function o(){$(".icon-error").hide(),$(".discount-amount").hide(),$(".icon-right").hide(),$("#discount-span").text("0"),$(".fc-fd1520-span").text(q)}function i(e,a){$.ajax({type:"post",url:n+"/checkDiscountCode/"+e,success:function(n){200==n.code?($(".icon-error").hide(),$(".discount-amount").show(),$(".icon-right").show(),$("#discount-span").text(n.data),$(".fc-fd1520-span").text(parseInt(q)-parseInt(n.data)),a&&(w.discountCode=e,a.call())):400==n.code&&($.trim(e)&&$(".icon-error").show(),$(".discount-amount").hide(),$(".icon-right").hide(),a&&(w.discountCode="@0",a.call()))}})}function r(e){e<=1?(C||_.off("click").on("click",m),_.text("获取验证码")):(_.off("click"),e-=1,_.text("重新获取("+e+")"),setTimeout(function(){r(e)},1e3))}function c(){$(".ktzhpage").hide(),$(".zhxxpage").show(),$('input[name="login"]').focus()}function s(){_.off("click"),C=!0,w={vcode:$('input[name="vcode"]').val(),discountCode:$('input[name="discountCode"]').val(),tradeNo:$('input[name="tradeNo"]').val(),openid:$('input[name="openid"]').val(),login:$('input[name="login"]').val(),password:$('input[name="password"]').val(),passwordConfirmation:$('input[name="passwordConfirmation"]').val(),company:$('input[name="company"]').val(),mobile:$('input[name="mobile"]').val(),code:$('input[name="code"]').val()};var e=$(".kt-item.hidden");e.eq(0).removeClass("hidden"),e.eq(1).removeClass("hidden"),e.eq(2).removeClass("hidden"),$("#kt_mobile").text($('input[name="mobile"]').val()),$("#kt_login").text($('input[name="login"]').val()),$("#kt_company").text($('input[name="company"]').val()),$(".zhxxpage").hide(),$(".ktzhpage .sf_btn").removeClass("sf_btn-default").addClass("sf_btn-primary"),$(".ktzhpage").show(),$('input[name="mobile"]').attr("readonly",!0).addClass("text-readonly"),$('input[name="code"]').attr("readonly",!0).addClass("text-readonly"),$("#btn_pay").css("margin","0.52rem 0")}function d(e){var a=t("账户校验");$.ajax({type:"post",url:n+"/sfpay/checkRegist",data:$("#registForm").serialize(),success:function(n){var a=n.code;200==a?e&&e.call(n):100==a?layer.msg("登录账号被占用"):101==a&&layer.msg("手机号已被占用")},error:function(){layer.msg("系统忙，请稍后再试")},complete:function(){layer.close(a)}})}function u(){$.ajax({type:"post",url:n+"/sfpay/pay",data:w,success:function(){window.location=n+"/toLogin/"+a},error:function(){layer.msg("系统忙，请稍后再试")},complete:function(){}})}function l(){$.ajax({type:"post",url:n+"/sfpay/cancel/"+b,success:function(){window.location=n+"/toLogin/"+a},error:function(){}})}function m(){var e=$('input[name="mobile"]').val();if(!$.trim(e))return void layer.msg("请输入有效的手机号");if(!/^1\d{10}$/.test(e))return void layer.msg("手机号格式不正确");var a=n+"/checkMobile/"+e,t=layer.load(0,{shade:!1});$.ajax({dataType:"json",type:"POST",data:{mobile:e},url:a,success:function(a){if(200==a.code){r(60);var t=n+"/sms";$.ajax({dataType:"json",type:"POST",data:{mobile:e},url:t,success:function(e){if(200==e.code){var n=e.data;$('input[name="vcode"]').val(n)}}})}else 422==a.code&&layer.msg("手机号已被占用")},complete:function(){layer.close(t)}})}function p(){var e=$(".zhxxpage input").validate({rules:{login:{required:"请输入登录账号",minlength:{msg:"登录账号长度不得少于4位",params:4},custom:{params:function(e){return/^[0-9a-zA-Z]*[0-9][0-9a-zA-Z]*$/.test(e)&&/^[0-9a-zA-Z]*[a-zA-Z][0-9a-zA-Z]*$/.test(e)},msg:"登录账号应为字母和数字的组合"}},password:{required:"请输入密码",minlength:{msg:"密码不得少于6位",params:6}},passwordConfirmation:{required:"请输入确认密码",custom:{params:function(e){return e==$('input[name="password"]').val()},msg:"两次输入的密码不一致"}},company:{required:"请输入企业名称",custom:{params:function(e){return/^[\u4e00-\u9fa5]{4,}$/.test(e)},msg:"企业名称应为4个及以上汉字"}},mobile:{required:"请输入手机号",mobile:"手机格式不正确"},code:{required:"请输入验证码",custom:{params:function(e){var n=$("input[name='vcode']").val();return!!$.trim(n)&&!($.trim(e)&&$.trim(n)&&n!=e)},msg:"验证码错误"}}}});e&&d(s)}function f(){$(".ktzhpage").is(":hidden")?($(".ktzhpage").show(),$(".zhxxpage").hide()):window.location=n+"/toLogin/"+a}function g(){WeixinJSBridge.invoke("getBrandWCPayRequest",x,function(e){"get_brand_wcpay_request：ok"==e.err_msg||"get_brand_wcpay_request:ok"==e.err_msg?(layer.msg("支付成功"),$("#btn_pay").off("click"),u()):"get_brand_wcpay_request：cancel"==e.err_msg||"get_brand_wcpay_request:cancel"==e.err_msg?l():"get_brand_wcpay_request：fail"!=e.err_msg&&"get_brand_wcpay_request:fail"!=e.err_msg||l()})}function y(e){x=e.data.packages,b=e.data.tradeNo,$("input[name='tradeNo']").val(b),w.tradeNo=b,"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",g,!1):document.attachEvent?(document.attachEvent("WeixinJSBridgeReady",g),document.attachEvent("onWeixinJSBridgeReady",g)):g():g()}function v(){var e=t("下单中");$.ajax({type:"post",url:n+"/sfpay/prepay/"+a,dataType:"json",data:w,success:function(e){var n=e.code;422==n?layer.msg("请勿重复提交订单"):423==n?layer.msg("登录账号已被占用"):424==n?($('input[name="mobile"]').attr("readonly",!1).removeClass("text-readonly"),$('input[name="code"]').attr("readonly",!1).removeClass("text-readonly"),_.off("click").on("click",m),layer.msg("手机号已被占用")):426==n||425==n?(layer.msg("下单失败"),$("#btn_pay").on("click",h)):200==n?y(e):layer.msg("系统繁忙，请稍后再试。")},error:function(){layer.msg("系统繁忙，请稍后再试。"),$("#btn_pay").on("click",h)},complete:function(){layer.close(e)}})}function h(){C?($("#btn_pay").off("click"),i($("#input-yhm").val(),function(){v()})):layer.msg("请完善个人信息")}var _,k,x,b,w,C=!1,q=e;$(function(){_=$("#smsCode"),_.on("click",function(){m()}),$("#input-yhm").keyup(function(){var e=$(this).val();e.length<4?o():e.length>=4&&e!=k&&($('input[name="discountCode"]').val($.trim(e)),i($.trim(e))),k=e}),$(".btn-back").click(f),$("#btnConfirm").click(p),$("#btnNavReg").click(c)}),$("#btn_pay").on("click",h)}
//# sourceMappingURL=maps/ktzhpage.min.js.map
